<!doctype html>
<html lang="{{ record['code'] }}">
    <head>
        <meta charset="utf-8">
        <title>{{ record['title'] }}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="{{ record['description']|e }}">
        {% if favico is not empty %}<link rel="icon" href="{{ favico }}" type="image/x-icon">{% endif %}
        {% if shortcut_icon is not empty %}<link rel="shortcut icon" href="{{ shortcut_icon }}" type="image/png">{% endif %}
        {% if apple_touch_icon is not empty %}<link rel="apple-touch-icon" href="{{ apple_touch_icon }}">{% endif %}
        <meta property="og:title" content="{{ record['title']|e }}">
        {% if record['description'] is not empty %}<meta property="og:description" content="{{ record['description']|e }}">{% endif %}
        {% if record['photo'] is not empty %}<meta property="og:image" content="{{ record['photo']|e }}">{% endif %}
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    </head>
    <body>
        <main class="container" style="width:50rem;margin-top:.75rem;margin-bottom:.75rem;">
            <header class="border-bottom mb-3">
                <a href="{{ 'pages'|link }}" class="d-flex text-decoration-none back-link">
                    <span class="fs-4 text-uppercase"><i class="bi bi-easel"></i> {{ 'dashboard'|text }}</span>
                </a>
            </header>
            <h2>{{ record['title'] }}</h2>
            {% if record['photo'] is not empty %}
                <img class="img-fluid mt-1" src="{{ record['photo'] }}">
            {% endif %}
            <div class="col-12 mt-1">
                {{ record['content']|raw }}
            </div>
            {% if files is not empty %}
            <div class="col-12 mt-5">
                <hr>
                <h5><i class="bi bi-paperclip"></i> {{ record['code'] == 'mn' ? 'Хавсралт файлууд' : 'Attachments' }}</h5>
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th style="width:50px">#</th>
                            <th>{{ record['code'] == 'mn' ? 'Файл' : 'File' }}</th>
                            <th style="width:120px">{{ record['code'] == 'mn' ? 'Хэмжээ' : 'Size' }}</th>
                            <th style="width:100px">{{ record['code'] == 'mn' ? 'Төрөл' : 'Type' }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file in files %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>
                                <a href="{{ file['path'] }}" target="_blank" class="text-decoration-none">
                                    {% if file['type'] == 'image' %}
                                        <i class="bi bi-file-image text-success"></i>
                                    {% elseif file['type'] == 'video' %}
                                        <i class="bi bi-file-play text-danger"></i>
                                    {% elseif file['type'] == 'audio' %}
                                        <i class="bi bi-file-music text-info"></i>
                                    {% elseif file['mime_content_type'] == 'application/pdf' %}
                                        <i class="bi bi-file-pdf text-danger"></i>
                                    {% elseif file['mime_content_type'] starts with 'application/vnd.ms-excel' or file['mime_content_type'] starts with 'application/vnd.openxmlformats-officedocument.spreadsheet' %}
                                        <i class="bi bi-file-excel text-success"></i>
                                    {% elseif file['mime_content_type'] starts with 'application/msword' or file['mime_content_type'] starts with 'application/vnd.openxmlformats-officedocument.wordprocessing' %}
                                        <i class="bi bi-file-word text-primary"></i>
                                    {% elseif file['mime_content_type'] starts with 'application/zip' or file['mime_content_type'] starts with 'application/x-rar' or file['mime_content_type'] starts with 'application/x-7z' %}
                                        <i class="bi bi-file-zip text-warning"></i>
                                    {% else %}
                                        <i class="bi bi-file-earmark"></i>
                                    {% endif %}
                                    {{ file['path']|basename }}
                                </a>
                                {% if file['description'] is not empty %}
                                    <small class="text-muted d-block">{{ file['description'] }}</small>
                                {% endif %}
                            </td>
                            <td>
                                {% if file['size'] < 1024 %}
                                    {{ file['size'] }} B
                                {% elseif file['size'] < 1048576 %}
                                    {{ (file['size'] / 1024)|round(1) }} KB
                                {% else %}
                                    {{ (file['size'] / 1048576)|round(2) }} MB
                                {% endif %}
                            </td>
                            <td><span class="badge bg-secondary">{{ file['type'] }}</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </main>
        <script type="text/javascript">
            const fromPage = new URLSearchParams(window.location.search).get('from');
            if (fromPage === 'nav') {
                document.querySelectorAll('a.back-link').forEach(a => { a.href = `{{ 'pages-nav'|link }}`; });
            }

            if (localStorage.getItem('data-bs-theme') === 'dark') {
                document.body.setAttribute('data-bs-theme', 'dark');
            }

            /* Scroll-To-Top Button */
            (function() {
                const upArrow = document.createElement('i');
                upArrow.style.cssText = 'border:solid white;border-width:0 2px 2px 0;display:inline-block;padding:3.4px;margin-top:11px;transform:rotate(-135deg)';

                const btn = document.createElement('a');
                btn.id = 'scrollToTopBtn';
                btn.style.cssText = 'display:inline-block;cursor:pointer;background-color:#7952b3;width:40px;height:25px;text-align:center;border-radius:6px 6px 0 0;position:fixed;right:25%;bottom:0;transition:background-color .3s,opacity .5s,visibility .5s;opacity:0;visibility:hidden;z-index:999';
                btn.appendChild(upArrow);
                document.body.appendChild(btn);

                window.addEventListener('scroll', function() {
                    if (document.documentElement.scrollTop > 200) {
                        btn.style.opacity = '0.75';
                        btn.style.visibility = 'visible';
                    } else {
                        btn.style.opacity = '0';
                        btn.style.visibility = 'hidden';
                    }
                });

                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    scroll({ top: 0, behavior: 'smooth' });
                });

                btn.addEventListener('mouseover', () => btn.style.backgroundColor = '#5a3d8a');
                btn.addEventListener('mouseout', () => btn.style.backgroundColor = '#7952b3');
            })();
        </script>
    </body>
</html>
